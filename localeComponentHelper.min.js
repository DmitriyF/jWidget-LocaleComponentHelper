/*!
	LocaleComponentHelper for jWidget

	Copyright (C) 2016 DmitriyF

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU Lesser General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU Lesser General Public License for more details.

	You should have received a copy of the GNU Lesser General Public License
	along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

JW.Plugins.DF=JW.Plugins.DF||{},JW.Plugins.DF.LocaleComponentHelper=function(n){JW.Plugins.DF.LocaleComponentHelper._super.call(this),this.config={},this.externalLocalePlugin=null,this._localePlugin=null,this.scope=null,this.sublocale=null,this.el=null,this._localizedElements=[],this._validateConfig(n)&&this._ininialize()},JW.extend(JW.Plugins.DF.LocaleComponentHelper,JW.Class,{asyncHtmlTag:"data-localized",syncHtmlTag:"data-localized-sync",_validateConfig:function(n){return this.config=n||{},n.localePlugin?(this.externalLocalePlugin=this.config.localePlugin,this.sublocale=this.config.sublocale||"",this.config.scope?(this.scope=this.config.scope,this.el=this.config.el||this.scope.el,this._localePlugin=this.sublocale?this.externalLocalePlugin.getSubLocale(this.sublocale):this.externalLocalePlugin,this._localizedElements=this.config.localizedElements||[],!0):(Console.error("JW.UI.Component [config.localePlugin] is not defined"),!1)):(Console.error("Language [config.localePlugin] Plugin is not defined"),!1)},_ininialize:function(){var n=this.el.find("["+this.asyncHtmlTag+"]"),i=this.el.find("["+this.syncHtmlTag+"]");this._bindAction(n,this._bindAsyncElement),this._bindAction(i,this._bindSyncElement),this._bindCustomAction()},_bindAction:function(n,i){for(var t=0;t<n.length;t++){var e=$(n[t]),l=this._getAliasName(e);l?i.call(this,e,this._localePlugin,l):this._showWarning("Localization alias not found for the element",e)}},_bindCustomAction:function(){JW.Array.each(this._localizedElements,this._bindCustomElement,this)},_bindCustomElement:function(n){if(!n.jwid)return void this._showWarning("Element name [jwid] not found",n);var i=n.aliasName?n.aliasName:JW.String.camel(n.jwid),t=n.isIgnoreSublocale?this.externalLocalePlugin:this._localePlugin,e=this.scope.getElement(n.jwid);n.isAutoUpdate?this._bindSyncElement(e,t,i):this._bindAsyncElement(e,t,i)},_bindAsyncElement:function(n,i,t){n.text(i.getString(t))},_bindSyncElement:function(n,i,t){var e=this.scope.own(i.getProperty(t));this.scope.own(n.jwtext(e))},_getAliasName:function(n){return n.attr(this.asyncHtmlTag)||n.attr(this.syncHtmlTag)},_showWarning:function(n,i){console.warn(n),console.warn(i),console.warn("______________________")}});